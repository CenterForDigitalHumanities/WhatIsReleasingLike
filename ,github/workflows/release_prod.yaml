# name: TinyNode release new version
# on:
#   push:
#     branches: ci-cd-release
#       tags:
#         - '[0-9]+.[0-9]+.[0-9]+'
# jobs:
#   test:
#     strategy:
#       matrix:
#         machines:
#           - vlcdhprdp02
#     runs-on: ${{ matrix.machines }}
#     steps:
#       - uses: actions/checkout@master
#       - name: Test the app on the server
#         run: |
#           cd /srv/node/tiny-node/
#           git stash
#           git checkout release
#           git pull
#           npm install
#           npm run allTests
#   release:
#     needs:
#       - test
#     strategy:
#       matrix:
#         machines:
#           - vlcdhprdp02
#     runs-on: ${{ matrix.machines }}
#     steps:
#       - uses: actions/checkout@master
#       - name: Deploy the app on the server
#         run: |
#           if [[ ! -e /srv/node/logs/tinynode.txt ]]; then
#               mkdir -p /srv/node/logs
#               touch /srv/node/logs/tinynode.txt
#           fi
#           cd /srv/node/tiny-node/
#           pm2 stop tinyNode
#           git stash
#           git checkout release
#           git pull
#           npm install
#           pm2 start -i max bin/tinyNode.js
#           git tag -a ${{ steps.bump.outputs.newVersion }} "Release ${{ steps.bump.outputs.newVersion }}"
#           git push upstream ${{ steps.bump.outputs.newVersion }}
#       - uses: fwilhe2/bump-version@main
#         id: bump
#       - run: echo ${{ steps.bump.outputs.newVersion }}
#       - uses: actions/create-release@v1
#         with:
#           tag_name: ${{ steps.bump.outputs.newVersion }}
#       - name: Generate Changelog
#         uses: scottbrenner/generate-changelog-action@master
#         id: Changelog
#         env:
#           REPO: ${{ github.repository }}
#       - name: Create Release
#         id: create_release
#         uses: actions/create-release@latest
#         env:
#           GITHUB_TOKEN: ${{ secrets.BRY_PAT }}
#         with:
#           tag_name: ${{ steps.bump.outputs.newVersion }}
#           release_name: Release ${{ steps.bump.outputs.newVersion }}
#           body: |
#             ${{ steps.Changelog.outputs.changelog }}
#           draft: false
#           prerelease: false

